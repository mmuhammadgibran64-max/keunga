<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIBRAN HUB - LOGIN</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #2f81f7; --text: #c9d1d9; --border: #30363d; --success: #238636; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: var(--card); border: 1px solid var(--border); padding: 30px; border-radius: 12px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; }
        h2 { color: var(--accent); margin-bottom: 25px; }
        .google-btn-wrapper { display: flex; justify-content: center; margin-top: 20px; }
        .status { margin-top: 20px; font-size: 13px; color: #8b949e; }
    </style>
</head>
<body>

<div class="login-box">
    <h2>GIBRAN HUB LOGIN</h2>
    <p>Silakan daftar/masuk menggunakan akun Google Anda</p>
    
    <div class="google-btn-wrapper">
        <div id="g_id_onload"
             data-client_id="594310366887-a3dsvn8plp139boru5kepf2o1c6ubkkv.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="filled_blue" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
    </div>

    <div id="statusMsg" class="status"></div>
</div>

<script>
    // Link Apps Script Anda
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwOFaA_xT3iffh_0JYNiJjacx4SJWsQmeHnVcCcpdRRAsaSbjmtoHIr0dMmWNAVEO1a/exec';

    function handleCredentialResponse(response) {
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.innerText = "Sedang menghubungkan ke Google Sheet...";

        // Decode data dari Google
        const responsePayload = parseJwt(response.credential);
        
        // Kirim data ke Google Sheets
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // Penting agar tidak kena blokir CORS
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                'action': 'google_login',
                'nama': responsePayload.name,
                'email': responsePayload.email,
                'sheetName': 'daftar pake gooogle' // Nama sheet tujuan
            })
        }).then(() => {
            statusMsg.style.color = 'var(--success)';
            statusMsg.innerText = "Data berhasil disimpan! Mengalihkan...";
            setTimeout(() => { 
                window.location.href = "dashboard.html"; 
            }, 2000);
        }).catch(err => {
            statusMsg.innerText = "Gagal mengirim data.";
            console.error(err);
        });
    }

    function parseJwt (token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }
</script>

</body>
</html>
