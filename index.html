<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIBRAN HUB - AUTH MASTER</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #2f81f7; --text: #c9d1d9; --border: #30363d; --success: #238636; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .auth-box { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 12px; width: 100%; max-width: 380px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: var(--accent); margin-bottom: 20px; font-size: 1.4rem; }
        label { display: block; margin-bottom: 5px; font-size: 12px; color: #8b949e; }
        input { width: 100%; padding: 10px; margin-bottom: 12px; background: #010409; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; outline: none; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-bottom: 10px; font-size: 14px; }
        .btn-success { background: var(--success); color: white; }
        .btn-purple { background: #8957e5; color: white; }
        .divider { display: flex; align-items: center; text-align: center; margin: 20px 0; color: #8b949e; font-size: 11px; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border); }
        .divider:not(:empty)::before { margin-right: .5em; }
        .divider:not(:empty)::after { margin-left: .5em; }
        .form-lengkap { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border); background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; }
        .loading { font-size: 12px; color: #e3b341; display: none; text-align: center; margin-top: 10px; font-weight: bold; }
        .status { text-align: center; font-size: 13px; margin-top: 15px; }
    </style>
</head>
<body>

<div class="auth-box">
    <h2>GIBRAN HUB</h2>
    
    <form id="formCepat">
        <label>Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Muhammad Gibran" required>
        <label>Nomor WA</label>
        <input type="tel" id="wa" placeholder="0812xxxxxx" required>
        <button type="submit" class="btn btn-success">DAFTAR SEKARANG</button>
    </form>

    <button onclick="toggleLengkap()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-size:12px; width:100%; text-decoration: underline;">+ Daftar Akun Lengkap (Alamat & Pass)</button>
    
   

    <div class="divider">ATAU LOGIN GOOGLE</div>

    <div style="display: flex; justify-content: center;">
        <div id="g_id_onload"
             data-client_id="594310366887-a3dsvn8plp139boru5kepf2o1c6ubkkv.apps.googleusercontent.com"
             data-callback="handleGoogle"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-theme="filled_blue" data-size="large"></div>
    </div>

    <div id="waitText" class="loading">‚è≥ Sedang sinkronisasi... Tunggu 1-3 menit ya!</div>
    <div id="status" class="status"></div>
</div>

<script>
    // LINK APPS SCRIPT TERBARU
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxANjja8K3NNeHBWENBftb1HSmfuksuxGJ3YaFXUqTVDjwwRjcL3QS2UKQgu8wcrnh9/exec';

    function toggleLengkap() {
        var x = document.getElementById("areaLengkap");
        x.style.display = (x.style.display === "block") ? "none" : "block";
    }

    // 1. DAFTAR CEPAT (Ke 'daftar pake gooogle')
    document.getElementById('formCepat').addEventListener('submit', function(e) {
        e.preventDefault();
        sendData({
            'action': 'manual_reg',
            'nama': document.getElementById('nama').value,
            'identitas': document.getElementById('wa').value
        });
    });

    // 2. DAFTAR LENGKAP (Ke 'daftar akun')
    function kirimLengkap() {
        const n = document.getElementById('nama').value;
        const w = document.getElementById('wa').value;
        const a = document.getElementById('alamat').value;
        const p = document.getElementById('pass').value;

        if(!n || !w || !a || !p) return alert("Lengkapi Form Akun dulu, Bro!");

        sendData({
            'action': 'reg_lengkap',
            'nama': n,
            'wa': w,
            'alamat': a,
            'pass': p
        });
    }

    // 3. GOOGLE LOGIN (Ke 'daftar pake gooogle')
    function handleGoogle(response) {
        const payload = parseJwt(response.credential);
        sendData({
            'action': 'google_login',
            'nama': payload.name,
            'identitas': payload.email
        });
    }

    function sendData(params) {
        document.getElementById('waitText').style.display = "block";
        document.getElementById('status').innerText = "Sedang mengirim data ke database...";

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams(params)
        }).then(() => {
            document.getElementById('status').innerText = "Berhasil! Akun Terdaftar.";
            document.getElementById('status').style.color = "var(--success)";
            setTimeout(() => { window.location.href = "dashboard.html"; }, 2000);
        });
    }

    function parseJwt(t){var b=t.split('.')[1];var j=decodeURIComponent(window.atob(b.replace(/-/g,'+').replace(/_/g,'/')).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)}).join(''));return JSON.parse(j)}
</script>

</body>
</html>

