<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIBRAN HUB - AUTH SYSTEM</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #2f81f7; --text: #c9d1d9; --border: #30363d; --success: #238636; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        
        .login-box { background: var(--card); border: 1px solid var(--border); padding: 30px; border-radius: 12px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: var(--accent); margin-bottom: 20px; }
        
        input { width: 100%; padding: 12px; margin-bottom: 15px; background: #010409; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; }
        
        .btn-primary { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .btn-secondary { width: 100%; padding: 10px; background: transparent; color: #8b949e; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; width: 100%; }

        .divider { display: flex; align-items: center; text-align: center; margin: 20px 0; color: #8b949e; font-size: 12px; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border); }
        .divider:not(:empty)::before { margin-right: .5em; }
        .divider:not(:empty)::after { margin-left: .5em; }

        .google-btn-wrapper { display: flex; justify-content: center; margin-top: 10px; }
        .status { text-align: center; margin-top: 15px; font-size: 13px; min-height: 20px; }
    </style>
</head>
<body>

<div class="login-box">
    <h2>GIBRAN HUB</h2>
    
    <form id="manualForm">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit" class="btn-primary">MASUK</button>
    </form>

    <button class="btn-secondary" onclick="alert('Gunakan Login Google di bawah untuk daftar cepat!')">DAFTAR AKUN BARU</button>

    <div class="divider">ATAU DAFTAR PAKAI GOOGLE</div>

    <div class="google-btn-wrapper">
        <div id="g_id_onload"
             data-client_id="594310366887-a3dsvn8plp139boru5kepf2o1c6ubkkv.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="filled_blue" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
    </div>

    <div id="statusMsg" class="status"></div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwOFaA_xT3iffh_0JYNiJjacx4SJWsQmeHnVcCcpdRRAsaSbjmtoHIr0dMmWNAVEO1a/exec';

    // 1. Fungsi Handle Login Google
    function handleCredentialResponse(response) {
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.innerText = "Mendapatkan data Google...";

        // Decode JWT Token dari Google
        const responsePayload = parseJwt(response.credential);
        
        console.log("ID: " + responsePayload.sub);
        console.log('Full Name: ' + responsePayload.name);
        console.log('Email: ' + responsePayload.email);

        // Kirim ke Google Sheets
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // Pakai no-cors untuk Apps Script
            headers: { 'Content-Type': 'application/json' },
            body: new URLSearchParams({
                'action': 'google_login',
                'nama': responsePayload.name,
                'email': responsePayload.email,
                'sheetName': 'daftar pake gooogle' // Sesuai permintaan lo
            })
        }).then(() => {
            statusMsg.style.color = 'var(--success)';
            statusMsg.innerText = "Berhasil Terdaftar! Mengalihkan...";
            setTimeout(() => { window.location.href = "dashboard.html"; }, 1500);
        }).catch(err => {
            statusMsg.innerText = "Gagal simpan ke Sheet!";
            console.error(err);
        });
    }

    // Fungsi Helper Decode Token
    function parseJwt (token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    };

    // 2. Handle Login Manual (Opsional)
    document.getElementById('manualForm').addEventListener('submit', e => {
        e.preventDefault();
        // Logika login manual lo yang lama...
        window.location.href = "dashboard.html";
    });
</script>

</body>
</html>
