<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Keuangan Gibran</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 550px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .form-section { border: 1px solid #eee; padding: 20px; border-radius: 12px; margin-bottom: 25px; background: #fff; }
        h3 { margin: 0 0 15px 0; color: #333; border-left: 4px solid #28a745; padding-left: 10px; font-size: 18px; }
        label { display: block; margin: 15px 0 5px; font-weight: 600; font-size: 13px; color: #555; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; background: #f9f9f9; }
        input[readonly] { background: #e9ecef; cursor: not-allowed; }
        button { width: 100%; padding: 14px; margin-top: 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-size: 16px; }
        .btn-green { background: #28a745; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2); }
        .btn-blue { background: #007bff; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2); }
        /* Style tombol login biar nggak menonjol banget */
        .login-wrapper { display: flex; justify-content: center; margin-bottom: 30px; transform: scale(0.9); }
    </style>
</head>
<body>

<div class="container">
    <div id="g_id_onload"
         data-client_id="845248187858-v5f617m11f.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    

    <div class="form-section">
        <h3>ðŸ’° FORM SETORAN</h3>
        <form id="formSetoran">
            <label>Nama yang Setor</label>
            <input type="text" name="nama" id="nama_setor" placeholder="Silahkan Login Google di atas" readonly>
            
            <label>Tanggal Setor</label>
            <input type="date" name="tanggal" required>
            
            <label>Setor Ke Siapa</label>
            <select name="tujuan">
                <option value="Bu Ami">Bu Ami</option>
                <option value="Bu Tati">Bu Tati</option>
            </select>
            
            <label>Keterangan/Bukti</label>
            <input type="text" name="keterangan" placeholder="Contoh: Setoran Mingguan">
            
            <button type="button" class="btn-green" onclick="kirimKeSheet('formSetoran', 'Form Setoran')">Kirim Setoran</button>
        </form>
    </div>

    <div class="form-section">
        <h3>ðŸ“‹ FORM LAPORAN</h3>
        <form id="formLaporan">
            <label>Nama yang Lapor</label>
            <input type="text" name="nama" id="nama_lapor" placeholder="Silahkan Login Google di atas" readonly>
            
            <label>Tanggal Lapor</label>
            <input type="date" name="tanggal" required>
            
            <label>Lapor Ke Siapa</label>
            <select name="tujuan">
                <option value="Bu Ami">Bu Ami</option>
                <option value="Bu Tati">Bu Tati</option>
            </select>
            
            <label>Keterangan/Bukti</label>
            <input type="text" name="keterangan" placeholder="Contoh: Laporan harian">
            
            <button type="button" class="btn-blue" onclick="kirimKeSheet('formLaporan', 'Form Laporan')">Kirim Laporan</button>
        </form>
    </div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwrstO8ggfEpfGAQjkGmEKo6CKLyG7YfxemvZ1Sn1H55ULFFOoSN2Fv-HFLrxw9Uobz/exec";

    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        
        // Isi nama otomatis
        document.getElementById('nama_setor').value = payload.name;
        document.getElementById('nama_lapor').value = payload.name;

        // Log login
        fetch(scriptURL + "?sheet=register.html", {
            method: "POST",
            body: JSON.stringify({
                type: 'google_login',
                nama: payload.name,
                email: payload.email
            })
        });

        // Sembunyikan tombol login setelah berhasil masuk (BIAR BERSIH!)
        document.querySelector('.login-wrapper').style.display = 'none';
    }

    function kirimKeSheet(formId, sheetTarget) {
        const form = document.getElementById(formId);
        const currentName = document.getElementById(formId === 'formSetoran' ? 'nama_setor' : 'nama_lapor').value;

        if(!currentName) {
            alert("Waduh, login Google dulu dong!");
            return;
        }

        const formData = new FormData(form);
        const uploadURL = scriptURL + "?sheet=" + encodeURIComponent(sheetTarget);

        fetch(uploadURL, {
            method: 'POST',
            body: formData
        })
        .then(() => {
            alert("Mantap! Data terkirim ke " + sheetTarget);
            form.reset();
            document.getElementById('nama_setor').value = currentName;
            document.getElementById('nama_lapor').value = currentName;
        })
        .catch(err => alert("Gagal kirim data: " + err));
    }
</script>

<script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/6993e93bd5bd3b1c3ca44cb6/1ji9fnh51';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
</script>

</body>
</html>

