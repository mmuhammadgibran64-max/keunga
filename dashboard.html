<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gibran Hub - Keuangan Fix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sidebar: #0b0e14; --main: #010409; --card: #161b22; --accent: #2f81f7; --success: #238636; --text: #c9d1d9; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--main); color: var(--text); overflow-x: hidden; }

        /* GATE LOGIN */
        #login-gate { position: fixed; inset: 0; background: var(--main); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .gate-box { background: var(--card); padding: 40px; border-radius: 15px; border: 1px solid #30363d; text-align: center; width: 320px; }

        /* DASHBOARD LAYOUT */
        #app-shell { display: none; height: 100vh; flex-direction: row; }
        .side-nav { width: 260px; background: var(--sidebar); border-right: 1px solid #30363d; padding: 25px; display: flex; flex-direction: column; flex-shrink: 0; }
        .main-area { flex: 1; padding: 40px; overflow-y: auto; }

        /* FORMS */
        .room { display: none; max-width: 1100px; margin: 0 auto; }
        .room.active { display: block; animation: fadeIn 0.4s; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .card { background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid #30363d; }
        
        h3 { margin-top: 0; border-bottom: 1px solid #30363d; padding-bottom: 10px; font-size: 16px; }
        label { display: block; font-size: 11px; margin: 15px 0 5px; color: #8b949e; font-weight: bold; }
        input, select { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 14px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-gate">
        <div class="gate-box">
            <i class="fas fa-user-shield fa-3x" style="color:var(--accent); margin-bottom:20px;"></i>
            <h3>Gibran Hub Access</h3>
            <div id="g_id_onload" data-client_id="594310366887-a3dsvn8plp139boru5kepf2o1c6ubkkv.apps.googleusercontent.com" data-callback="onAuth"></div>
            <div class="g_id_signin" data-type="standard" data-theme="filled_blue"></div>
        </div>
    </div>

    <div id="app-shell">
        <div class="side-nav">
            <h2 style="color:var(--accent); margin-bottom:40px;"><i class="fas fa-rocket"></i> HUB</h2>
            <button onclick="nav('fin')" style="background:#21262d; color:white; border:none; padding:12px; border-radius:8px; text-align:left; cursor:pointer; margin-bottom:10px;"><i class="fas fa-wallet"></i> Keuangan</button>
            <button onclick="nav('up')" style="background:transparent; color:var(--text); border:none; padding:12px; text-align:left; cursor:pointer;"><i class="fas fa-upload"></i> Upload</button>
        </div>

        <div class="main-area">
            <div id="fin" class="room active">
                <div class="form-grid">
                    <div class="card">
                        <h3 style="color:var(--success)">FORM SETORAN</h3>
                        <label>NAMA PENYETOR</label><input type="text" id="s_nama" readonly>
                        <label>TANGGAL</label><input type="date" id="s_tgl">
                        <label>SETOR KE</label>
                        <select id="s_ke"><option>Bu Ami</option><option>Bu Tati</option></select>
                        <label>TANDA TANGAN</label><input type="text" id="s_ttd" placeholder="Nama Terang">
                        <label>LINK BUKTI</label><input type="text" id="s_bukti" placeholder="Paste link dari menu Upload">
                        <button class="btn" style="background:var(--success)" onclick="sendToSheet('Form Setoran')">KIRIM SETORAN</button>
                    </div>
                    <div class="card">
                        <h3 style="color:var(--accent)">FORM LAPORAN</h3>
                        <label>NAMA PELAPOR</label><input type="text" id="l_nama" readonly>
                        <label>TANGGAL</label><input type="date" id="l_tgl">
                        <label>LAPOR KE</label>
                        <select id="l_ke"><option>Bu Ami</option><option>Bu Tati</option></select>
                        <label>TANDA TANGAN</label><input type="text" id="l_ttd" placeholder="Nama Terang">
                        <label>LINK BUKTI</label><input type="text" id="l_bukti" placeholder="Paste link dari menu Upload">
                        <button class="btn" style="background:var(--accent)" onclick="sendToSheet('Form Laporan')">KIRIM LAPORAN</button>
                    </div>
                </div>
            </div>

            <div id="up" class="room">
                <h3>UPLOAD BUKTI KE CLOUDINARY</h3>
                <div class="card" style="text-align:center">
                    <input type="file" id="fInp" onchange="runUpload(this)">
                    <p id="upMsg" style="margin-top:20px; font-weight:bold; color:var(--accent)"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        const API = "https://script.google.com/macros/s/AKfycbwrstO8ggfEpfGAQjkGmEKo6CKLyG7YfxemvZ1Sn1H55ULFFOoSN2Fv-HFLrxw9Uobz/exec";

        function onAuth(res) {
            const user = JSON.parse(atob(res.credential.split('.')[1]));
            document.getElementById('s_nama').value = user.name;
            document.getElementById('l_nama').value = user.name;
            document.getElementById('login-gate').style.display = 'none';
            document.getElementById('app-shell').style.display = 'flex';
        }

        function nav(id) {
            document.querySelectorAll('.room').forEach(r => r.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function runUpload(el) {
            const file = el.files[0]; if(!file) return;
            document.getElementById('upMsg').innerText = "Sedang Upload...";
            
            const fd = new FormData();
            fd.append('file', file);
            fd.append('upload_preset', 'ml_default');

            try {
                const r = await fetch("https://api.cloudinary.com/v1_1/dnl8vattg/auto/upload", { method: 'POST', body: fd });
                const d = await r.json();
                if(d.secure_url) {
                    alert("UPLOAD BERHASIL!");
                    document.getElementById('upMsg').innerHTML = `Link: <br><small>${d.secure_url}</small>`;
                } else {
                    alert("Gagal ambil link, cek Cloudinary lo!");
                }
            } catch(e) { alert("Error koneksi!"); }
        }

        function sendToSheet(type) {
            let d = { sheet_id: "1y2O_3fK0k1Ds-diQ5M8857A27J-LDEZGdmYia1ykjOY", sheet_name: type };
            if(type === 'Form Setoran') {
                d.nama = document.getElementById('s_nama').value;
                d.tanggal = document.getElementById('s_tgl').value;
                d.tujuan = document.getElementById('s_ke').value;
                d.ttd = document.getElementById('s_ttd').value;
                d.bukti = document.getElementById('s_bukti').value;
            } else {
                d.nama = document.getElementById('l_nama').value;
                d.tanggal = document.getElementById('l_tgl').value;
                d.tujuan = document.getElementById('l_ke').value;
                d.ttd = document.getElementById('l_ttd').value;
                d.bukti = document.getElementById('l_bukti').value;
            }

            fetch(API, { method: 'POST', body: JSON.stringify(d) })
            .then(() => alert("Data " + type + " sudah mendarat di Sheet!"));
        }
    </script>
</body>
</html>
