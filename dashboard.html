<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gibran Hub - Ultimate Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sidebar-bg: #0d1117; --body-bg: #010409; --card-bg: #161b22; --accent: #2f81f7; --text: #c9d1d9; --success: #238636; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--body-bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* GATE LOGIN */
        #login-gate { position: fixed; inset: 0; background: var(--body-bg); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .gate-box { background: var(--card-bg); padding: 40px; border-radius: 20px; border: 1px solid #30363d; text-align: center; width: 350px; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid #30363d; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .logo { font-size: 20px; font-weight: 800; color: var(--accent); margin-bottom: 40px; display: flex; align-items: center; gap: 12px; }
        .nav-item { width: 100%; padding: 12px 15px; background: transparent; color: var(--text); border: none; border-radius: 8px; text-align: left; cursor: pointer; display: flex; align-items: center; gap: 12px; margin-bottom: 10px; transition: 0.2s; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: #21262d; color: var(--accent); }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .room { display: none; max-width: 1000px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .room.active { display: block; }

        /* CARDS & FORMS */
        .card { background: var(--card-bg); border: 1px solid #30363d; padding: 25px; border-radius: 12px; margin-bottom: 25px; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        label { display: block; font-size: 11px; margin-bottom: 6px; color: #8b949e; font-weight: bold; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; box-sizing: border-box; margin-bottom: 15px; }
        
        .btn-main { width: 100%; padding: 14px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        
        /* FILE MANAGER UI */
        .upload-zone { border: 2px dashed #30363d; padding: 40px; text-align: center; border-radius: 12px; cursor: pointer; margin-bottom: 20px; transition: 0.3s; }
        .upload-zone:hover { border-color: var(--accent); background: #0d1117; }
        .file-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .file-item { background: #21262d; border-radius: 8px; padding: 10px; border: 1px solid #30363d; text-align: center; position: relative; }
        .file-item img { width: 100%; height: 100px; object-fit: cover; border-radius: 4px; }
        .copy-tag { font-size: 10px; background: var(--accent); color: white; padding: 2px 5px; border-radius: 4px; cursor: pointer; margin-top: 8px; display: inline-block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-gate">
        <div class="gate-box">
            <i class="fas fa-key fa-3x" style="color:var(--accent); margin-bottom:20px;"></i>
            <h2>Gibran Hub Access</h2>
            <div id="g_id_onload" data-client_id="594310366887-a3dsvn8plp139boru5kepf2o1c6ubkkv.apps.googleusercontent.com" data-callback="handleAuth"></div>
            <div class="g_id_signin" data-type="standard" data-theme="filled_blue"></div>
        </div>
    </div>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-rocket"></i> GIBRAN HUB</div>
        <button class="nav-item active" onclick="showRoom('finance', this)"><i class="fas fa-wallet"></i> Ruang Keuangan</button>
        <button class="nav-item" onclick="showRoom('storage', this)"><i class="fas fa-cloud-upload-alt"></i> File Manager</button>
        
        <div style="margin-top: auto; border-top: 1px solid #30363d; padding-top: 20px;">
            <p id="userMail" style="font-size: 11px; color: #8b949e; margin-bottom: 10px;"></p>
            <button onclick="location.reload()" style="background:none; border:none; color:#f85149; cursor:pointer; font-size:13px;"><i class="fas fa-power-off"></i> Logout</button>
        </div>
    </div>

    <div class="main-content">
        
        <div id="finance" class="room active">
            <h2 style="margin-bottom: 25px;">ðŸ’° Sinkronisasi Keuangan</h2>
            <div class="grid-2">
                <div class="card">
                    <h4 style="color:var(--success); margin-top:0;"><i class="fas fa-arrow-up"></i> SETORAN</h4>
                    <label>Penyetor</label><input type="text" id="s_nama" readonly>
                    <label>Tanggal</label><input type="date" id="s_tgl">
                    <label>Tujuan</label>
                    <select id="s_ke"><option>Bu Ami</option><option>Bu Tati</option></select>
                    <label>TTD</label><input type="text" id="s_ttd" placeholder="Nama Terang">
                    <label>Bukti (Link)</label><input type="text" id="s_bukti" placeholder="Upload di menu File Manager / Paste link">
                    <button class="btn-main" style="background:var(--success)" onclick="kirimSheet('Form Setoran')">KIRIM DATA</button>
                </div>
                <div class="card">
                    <h4 style="color:var(--accent); margin-top:0;"><i class="fas fa-file-invoice"></i> LAPORAN</h4>
                    <label>Pelapor</label><input type="text" id="l_nama" readonly>
                    <label>Tanggal</label><input type="date" id="l_tgl">
                    <label>Tujuan</label>
                    <select id="l_ke"><option>Bu Ami</option><option>Bu Tati</option></select>
                    <label>TTD</label><input type="text" id="l_ttd" placeholder="Nama Terang">
                    <label>Bukti (Link)</label><input type="text" id="l_bukti" placeholder="Upload di menu File Manager / Paste link">
                    <button class="btn-main" style="background:var(--accent)" onclick="kirimSheet('Form Laporan')">KIRIM DATA</button>
                </div>
            </div>
        </div>

        <div id="storage" class="room">
            <h2 style="margin-bottom: 25px;">ðŸ“‚ File Manager & Cloud Upload</h2>
            <div class="card">
                <div class="upload-zone" onclick="document.getElementById('megaUpload').click()">
                    <i class="fas fa-cloud-upload-alt fa-3x" style="color: #30363d; margin-bottom: 15px;"></i>
                    <p>Klik di sini untuk upload banyak file sekaligus</p>
                    <p style="font-size: 11px; color: #8b949e;">Mendukung Foto, Video, PDF (Max 100MB per file)</p>
                    <input type="file" id="megaUpload" multiple style="display:none" onchange="handleMegaUpload(this)">
                </div>
                
                <div id="upProgress" style="display:none; text-align:center; margin-bottom:20px; color:var(--accent);">
                    <i class="fas fa-spinner fa-spin"></i> Lagi proses upload ke Cloudinary...
                </div>

                <div class="file-list" id="fileGallery">
                    </div>
            </div>
        </div>

    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzzkZgu25V0CrZ2inKPreQpTox8szS_KrZQT3xdWtpBIA7QzPxD-OxWe5QIuqPvu8Au/exec";

        function handleAuth(res) {
            const user = JSON.parse(atob(res.credential.split('.')[1]));
            document.getElementById('s_nama').value = user.name;
            document.getElementById('l_nama').value = user.name;
            document.getElementById('userMail').innerText = user.email;
            document.getElementById('login-gate').style.display = 'none';
        }

        function showRoom(id, btn) {
            document.querySelectorAll('.room').forEach(r => r.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        // FUNGSI UPLOAD BANYAK FILE (FILE MANAGER)
        async function handleMegaUpload(inp) {
            const files = inp.files; if(files.length === 0) return;
            const progress = document.getElementById('upProgress');
            progress.style.display = 'block';

            for(let f of files) {
                const fd = new FormData();
                fd.append('file', f);
                fd.append('upload_preset', 'ml_default');

                try {
                    const r = await fetch("https://api.cloudinary.com/v1_1/dnl8vattg/auto/upload", { method: 'POST', body: fd });
                    const d = await r.json();
                    renderFile(d.secure_url, f.name);
                } catch(e) { console.error("Upload Error"); }
            }
            progress.style.display = 'none';
            alert("Berhasil Upload " + files.length + " File!");
        }

        function renderFile(url, name) {
            const gal = document.getElementById('fileGallery');
            const div = document.createElement('div');
            div.className = 'file-item';
            div.innerHTML = `
                <img src="${url}" onerror="this.src='https://via.placeholder.com/100?text=FILE'">
                <div style="font-size:10px; overflow:hidden; white-space:nowrap; margin-top:5px;">${name}</div>
                <div class="copy-tag" onclick="copyToClipboard('${url}')">Copy Link</div>
            `;
            gal.appendChild(div);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => alert("Link Berhasil Disalin!"));
        }

        function kirimSheet(type) {
            let d = {
                sheet_id: "1y2O_3fK0k1Ds-diQ5M8857A27J-LDEZGdmYia1ykjOY",
                sheet_name: type,
                nama: (type === 'Form Setoran') ? document.getElementById('s_nama').value : document.getElementById('l_nama').value,
                tanggal: (type === 'Form Setoran') ? document.getElementById('s_tgl').value : document.getElementById('l_tgl').value,
                tujuan: (type === 'Form Setoran') ? document.getElementById('s_ke').value : document.getElementById('l_ke').value,
                ttd: (type === 'Form Setoran') ? document.getElementById('s_ttd').value : document.getElementById('l_ttd').value,
                bukti: (type === 'Form Setoran') ? document.getElementById('s_bukti').value : document.getElementById('l_bukti').value
            };

            if(!d.tanggal || !d.ttd) return alert("Lengkapi data!");

            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(d) })
            .then(() => alert("Data Berhasil Masuk ke Sheet!"));
        }
    </script>
</body>
</html>
