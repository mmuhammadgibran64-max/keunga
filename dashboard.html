<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Gibran</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .user-box { display: flex; align-items: center; gap: 10px; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd; }
        .form-section { border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        h3 { margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        label { display: block; margin: 10px 0 5px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.3s; }
        .btn-green { background: #28a745; }
        .btn-blue { background: #007bff; }
    </style>
</head>
<body>

<div class="container">
    <div class="user-box">
        <img id="profilePic" src="" width="40" style="border-radius: 50%; background: #ccc;">
        <div><b id="dispName">Memuat...</b><br><small id="dispEmail"></small></div>
    </div>

    <div id="g_id_onload"
         data-client_id="845248187858-v5f617m11f.apps.googleusercontent.com" 
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin" data-type="standard"></div>

    <hr style="margin: 20px 0;">

    <div class="form-section">
        <h3>ðŸ’° FORM SETORAN</h3>
        <label>Nama yang Setor</label><input type="text" id="nama_setor">
        <label>Tanggal Setor</label><input type="date" id="tgl_setor">
        <label>Setor Ke Siapa</label>
        <select id="setor_ke">
            <option value="Bu Ami">Bu Ami</option>
            <option value="Bu Tati">Bu Tati</option>
        </select>
        <label>Keterangan</label><input type="text" id="bukti_setor">
        <button class="btn-green" onclick="kirimData('Form Setoran')">Kirim Setoran</button>
    </div>

    <div class="form-section">
        <h3>ðŸ“‹ FORM LAPORAN</h3>
        <label>Nama yang Lapor</label><input type="text" id="nama_lapor">
        <label>Tanggal Lapor</label><input type="date" id="tgl_lapor">
        <label>Lapor Ke Siapa</label>
        <select id="lapor_ke">
            <option value="Bu Ami">Bu Ami</option>
            <option value="Bu Tati">Bu Tati</option>
        </select>
        <label>Keterangan</label><input type="text" id="bukti_lapor">
        <button class="btn-blue" onclick="kirimData('Form Laporan')">Kirim Laporan</button>
    </div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
    // Link Apps Script lo yang paling baru
    const scriptURL = "https://script.google.com/macros/s/AKfycbwrstO8ggfEpfGAQjkGmEKo6CKLyG7YfxemvZ1Sn1H55ULFFOoSN2Fv-HFLrxw9Uobz/exec";

    // 1. Ambil data dari localStorage (kalau sudah login)
    document.getElementById('dispName').innerText = localStorage.getItem('userName') || "Belum Login";
    document.getElementById('dispEmail').innerText = localStorage.getItem('userEmail') || "";
    document.getElementById('profilePic').src = localStorage.getItem('userPic') || "";
    document.getElementById('nama_setor').value = localStorage.getItem('userName') || "";
    document.getElementById('nama_lapor').value = localStorage.getItem('userName') || "";

    // 2. Fungsi Login Google
    function handleCredentialResponse(response) {
        fetch(scriptURL + "?sheet=register.html", {
            method: "POST",
            body: JSON.stringify({ token: response.credential, type: 'google_login' })
        })
        .then(() => alert("Login Berhasil & Terdaftar di Sheet!"))
        .catch(err => console.error(err));
    }

    // 3. Fungsi Kirim Data (Setoran/Laporan)
    function kirimData(namaSheet) {
        let payload = { "sheet": namaSheet };

        if(namaSheet === 'Form Setoran') {
            payload.nama = document.getElementById('nama_setor').value;
            payload.tanggal = document.getElementById('tgl_setor').value;
            payload.tujuan = document.getElementById('setor_ke').value;
            payload.keterangan = document.getElementById('bukti_setor').value;
        } else {
            payload.nama = document.getElementById('nama_lapor').value;
            payload.tanggal = document.getElementById('tgl_lapor').value;
            payload.tujuan = document.getElementById('lapor_ke').value;
            payload.keterangan = document.getElementById('bukti_lapor').value;
        }

        fetch(scriptURL + "?sheet=" + namaSheet, { 
            method: 'POST', 
            mode: 'no-cors', 
            body: JSON.stringify(payload) 
        })
        .then(() => alert("Mantap! Data berhasil masuk ke tab " + namaSheet))
        .catch(err => alert("Gagal: " + err));
    }
</script>

<script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/6993e93bd5bd3b1c3ca44cb6/1ji9fnh51';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
</script>

</body>
</html>
