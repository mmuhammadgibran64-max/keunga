<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Keuangan Gibran</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .form-section { border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        h3 { margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #28a745; padding-bottom: 5px; }
        label { display: block; margin: 10px 0 5px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.3s; }
        .btn-green { background: #28a745; }
        .btn-blue { background: #007bff; }
        #g_id_signin { display: flex; justify-content: center; margin-bottom: 25px; }
    </style>
</head>
<body>

<div class="container">
    <div id="g_id_onload"
         data-client_id="845248187858-v5f617m11f.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    <div id="g_id_signin" class="g_id_signin" data-type="standard"></div>

    <div class="form-section">
        <h3>ðŸ’° FORM SETORAN</h3>
        <form id="formSetoran">
            <label>Nama yang Setor</label>
            <input type="text" name="nama" id="nama_setor" placeholder="Nama otomatis terisi setelah login" readonly>
            
            <label>Tanggal Setor</label>
            <input type="date" name="tanggal" required>
            
            <label>Setor Ke Siapa</label>
            <select name="tujuan">
                <option value="Bu Ami">Bu Ami</option>
                <option value="Bu Tati">Bu Tati</option>
            </select>
            
            <label>Keterangan/Bukti</label>
            <input type="text" name="keterangan" placeholder="Contoh: Setoran Mingguan">
            
            <button type="button" class="btn-green" onclick="kirimKeSheet('formSetoran', 'Form Setoran')">Kirim Setoran</button>
        </form>
    </div>

    <div class="form-section">
        <h3>ðŸ“‹ FORM LAPORAN</h3>
        <form id="formLaporan">
            <label>Nama yang Lapor</label>
            <input type="text" name="nama" id="nama_lapor" placeholder="Nama otomatis terisi setelah login" readonly>
            
            <label>Tanggal Lapor</label>
            <input type="date" name="tanggal" required>
            
            <label>Lapor Ke Siapa</label>
            <select name="tujuan">
                <option value="Bu Ami">Bu Ami</option>
                <option value="Bu Tati">Bu Tati</option>
            </select>
            
            <label>Keterangan/Bukti</label>
            <input type="text" name="keterangan" placeholder="Contoh: Laporan harian">
            
            <button type="button" class="btn-blue" onclick="kirimKeSheet('formLaporan', 'Form Laporan')">Kirim Laporan</button>
        </form>
    </div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
    // LINK APPS SCRIPT KEUANGAN GIBRAN
    const scriptURL = "https://script.google.com/macros/s/AKfycbwrstO8ggfEpfGAQjkGmEKo6CKLyG7YfxemvZ1Sn1H55ULFFOoSN2Fv-HFLrxw9Uobz/exec";

    // 1. Fungsi saat login berhasil
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        
        // Langsung isi nama ke semua form input
        document.getElementById('nama_setor').value = payload.name;
        document.getElementById('nama_lapor').value = payload.name;

        // Kirim data login ke sheet register.html
        fetch(scriptURL + "?sheet=register.html", {
            method: "POST",
            body: JSON.stringify({
                type: 'google_login',
                nama: payload.name,
                email: payload.email
            })
        });
    }

    // 2. Fungsi kirim data form
    function kirimKeSheet(formId, sheetTarget) {
        const form = document.getElementById(formId);
        const namaUser = document.getElementById(formId === 'formSetoran' ? 'nama_setor' : 'nama_lapor').value;

        if(!namaUser) {
            alert("Woi, Login Google dulu biar namanya muncul!");
            return;
        }

        const formData = new FormData(form);
        const uploadURL = scriptURL + "?sheet=" + encodeURIComponent(sheetTarget);

        fetch(uploadURL, {
            method: 'POST',
            body: formData
        })
        .then(() => {
            alert("Siap! Data " + sheetTarget + " udah masuk ke Sheet.");
            form.reset();
            // Isi balik nama setelah reset form
            document.getElementById('nama_setor').value = namaUser;
            document.getElementById('nama_lapor').value = namaUser;
        })
        .catch(err => alert("Waduh gagal kirim: " + err));
    }
</script>

<script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/6993e93bd5bd3b1c3ca44cb6/1ji9fnh51';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
</script>

</body>
</html>
